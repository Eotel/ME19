# プロジェクト概要

このプロジェクトは、カメラから映像を取得し、その映像ストリーム内の QR コードを検出し、デコードしたデータをファイルに書き込みます。

## ファイルの説明

- `cmd/me19/main.go`: メインのアプリケーションファイルです。カメラと QR コードスキャナーを初期化し、ビデオフレームをキャプチャし、QR コードをデコードし、デコードされたデータをファイルに書き込みます。また、プログラム終了シグナルも処理します。
- `configs/config.go`: アプリケーションの設定構造体を定義します。
- `configs/loader.go`: 設定ファイルの読み込みと環境変数からの設定を処理します。
- `configs/finder.go`: 設定ファイルを標準的な場所から自動的に検索します。
- `internal/camera/`: カメラキャプチャ関連のモジュールです。
- `internal/qrcode/`: QR コード検出関連のモジュールです。
- `internal/fileio/`: ファイル入出力関連のモジュールです。

## 依存関係

- [gocv](https://github.com/hybridgroup/gocv): カメラキャプチャと画像処理に使用されます。
- [gozxing](https://github.com/makiuchi-d/gozxing): QR コードのデコードに使用されます。
- [viper](https://github.com/spf13/viper): 設定ファイル管理に使用されます。

## 使い方

### コンパイルと実行

```bash
# ビルド
go build -o me19 ./cmd/me19

# 実行
./me19
```

### コマンドライン引数

```
Usage: me19 [options]

Options:
  -config string   設定ファイルのパス
  -c string        設定ファイルのパス（短縮形）
  -device int      カメラデバイスID
  -d int           カメラデバイスID（短縮形）
  -output string   出力ファイルパス
  -o string        出力ファイルパス（短縮形）
  -h               ヘルプメッセージの表示
```

例：

```bash
# カスタム設定ファイルを使用
me19 -config my_config.json

# カメラデバイスIDを指定
me19 -d 1

# 出力ファイルを指定
me19 -o scan_results.txt
```

### 設定

ME19 は以下の方法で設定できます：

1. 自動検出される標準的な場所の設定ファイル
2. `-config` フラグで指定された設定ファイル
3. `-device` と `-output` フラグでの個別設定
4. 環境変数によるオーバーライド

設定の優先順位は次の通りです（上が優先）：

1. 環境変数
2. コマンドライン引数
3. 設定ファイル
4. デフォルト設定

設定ファイルが見つからない場合でも、デフォルト設定が使用されるため、すぐに使い始めることができます。

### 出力ファイル

デフォルトでは、QR コードの読み取り結果はカレントディレクトリの `code.txt` に保存されます。
別の場所に保存するには、次のいずれかの方法で指定できます：

1. コマンドラインで指定: `me19 -output /path/to/output.txt`
2. 環境変数で指定: `export ME19_OUTPUT_FILE_PATH=/path/to/output.txt`
3. 設定ファイルで指定

### 詳細

詳細な使い方については、[USER_GUIDE.md](USER_GUIDE.md)を参照してください。

## Go プロジェクトの実装状況

以下は、C++プロジェクトを Go で再実装するタスクの進捗状況です。

### タスク一覧

| ID  | カテゴリ     | タスク                            | 説明                                                                         | 優先度 | 依存関係       | 着手 |
| --- | ------------ | --------------------------------- | ---------------------------------------------------------------------------- | ------ | -------------- | ---- |
| 1   | 環境構築     | Go のインストールと環境設定       | Go 言語（最新版）をインストールし、GOPATH と GOROOT を設定する               | 高     | なし           | [x]  |
| 2   | 環境構築     | プロジェクト構造の作成            | Go 標準のプロジェクト構造を作成し、モジュール初期化（go mod init）を行う     | 高     | 1              | [x]  |
| 3   | 依存関係     | カメラキャプチャライブラリの調査  | Go で OpenCV の機能を利用するためのライブラリ（gocv 等）を調査し選定する     | 高     | 1              | [x]  |
| 4   | 依存関係     | QR コード読み取りライブラリの調査 | Go で QR コードを読み取るためのライブラリを調査し選定する                    | 高     | 1              | [x]  |
| 5   | 依存関係     | 必要なライブラリのインストール    | 選定したライブラリをインストールし、依存関係を設定する                       | 高     | 3, 4           | [x]  |
| 6   | 実装         | カメラキャプチャモジュールの実装  | カメラからの映像取得機能を実装する                                           | 高     | 5              | [x]  |
| 7   | 実装         | QR コード検出モジュールの実装     | キャプチャした映像から QR コードを検出する機能を実装する                     | 高     | 6              | [x]  |
| 8   | 実装         | ファイル出力モジュールの実装      | 検出した QR コードの内容をファイルに書き込む機能を実装する                   | 高     | 7              | [x]  |
| 9   | 実装         | シグナルハンドリングの実装        | プログラム終了シグナルを適切に処理する機能を実装する                         | 中     | 6              | [x]  |
| 10  | 実装         | 設定ファイルの実装                | 読み取り間隔やファイルパスなどの設定を外部ファイルから読み込む機能を実装する | 中     | 8              | [x]  |
| 11  | テスト       | ユニットテストの作成              | 各モジュールのユニットテストを作成する                                       | 中     | 6, 7, 8, 9     | [x]  |
| 12  | テスト       | 統合テストの作成                  | システム全体の統合テストを作成する                                           | 中     | 11             | [x]  |
| 13  | ドキュメント | コードドキュメントの作成          | GoDoc に準拠したコードドキュメントを作成する                                 | 低     | 6, 7, 8, 9, 10 | [x]  |
| 14  | ドキュメント | ユーザードキュメントの作成        | インストール方法、使用方法、設定方法などを記載したドキュメントを作成する     | 低     | 13             | [x]  |
| 15  | 配布         | バイナリのビルドと配布方法の確立  | 各プラットフォーム向けのバイナリをビルドし、配布する方法を確立する           | 低     | 12             | [x]  |
